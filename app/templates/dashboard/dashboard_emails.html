
{% extends "dashboard/dashboard_base.html" %}
{% block content %}
<span class="h3 pt-2">Email Addresses</span>
<hr>
<div class="mt-5">
  <table class="table table-hover">
    <thead>
      <tr>
        <th class="text-center" scope="col">Email</th>
        <th class="text-center" scope="col">Phishing Emails Detected</th>
        <th class="text-center" scope="col">Last Updated</th>
        <th class="text-center" scope="col">Active Status</th>
        <th class="text-center" scope="col">Clean Mailbox</th>
        <th class="text-center" scope="col">Change Password</th>
        <th class="text-center" scope="col">Activate</th>
      </tr>
    </thead>
    <tbody>
      {% for email in user_emails %}
      <tr>
        <td class="text-center">{{ email.email_address }}</td>
        <td class="text-center">{{ email.phishing_mail_detected }}</td>
        <td class="text-center">{{ email.last_updated }}</td>
        <td class="text-center"> {{ email.active }}</td>
        <td class="text-center"> <a class="lni lni-brush" id="{{ email.email_id }}" name="{{ email.email_address }}" href="#" onclick="phish({{ email.email_id }});"></a></td>
        <td class="text-center"> <a class="lni lni-pencil"></a></td>
        <td class="text-center"> <a class="lni lni-power-switch" id="{{ email.email_id }}" name="{{ email.email_address}}" href="#" onclick="activate({{ email.email_id }});"></a></td>
      </tr>
      {% endfor %}
    </table>
  </div>
  <hr>
  <!-- Button trigger modal -->
  <button type="button" class="main-btn m-2" data-toggle="modal" data-target="#addMailModal">
    Add New Email
  </button>

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      {% for message in messages %}
        <span class="alert alert-danger">{{ message }}</span>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- Modal -->
  <div class="modal fade" id="addMailModal" tabindex="-1" role="dialog" aria-labelledby="addMailModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addMailModalLabel">Add New Email</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <form action="" method="post" novalidate>
          {{ form.hidden_tag() }}
          <div class="modal-body">
            <div class="p-2">
              {{ form.email_address.label}}
              {{ form.email_address(class='form-control') }}
            </div>
            {% for error in form.email_address.errors %}
            <span> {{ error }} </span>
            {% endfor %}
            <div class="p-2">
              {{ form.password.label }}
              {{ form.password(class='form-control') }}
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="main-btn" data-dismiss="modal">Close</button>
            {{ form.submit(class='main-btn') }}
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    function phish(mail_id) {
      var names = document.getElementById(mail_id).name;
      let url = "emails/phish/" + mail_id;
      window.location.href = url;
    }

    function activate(mail_id) {
      window.location.href = "emails/activation/" + mail_id;
    }
  </script>

  {% endblock %}
