
{% extends "dashboard/dashboard_base.html" %}
{% block content %}

<span class="h1"> User Dashboard </span><br/>
<span class="h2"> Currently logged in: <b>{{ current_user }}</b></span><br/>

<form action="" method="post" novalidate>
  {{ form.hidden_tag() }}
  {{ form.email_address.label}}
  {{ form.email_address(size=32) }}

  {% for error in form.email_address.errors %}
    <span> {{ error }} </span>
  {% endfor %}

  </br>
  {{ form.password.label }}
  {{ form.password }}
  </br>
  {{ form.submit }}
</form>

{% with messages = get_flashed_messages() %}
  {% if messages %}
    {% for message in messages %}
      <h2> {{ message }} </h2>
    {% endfor %}
  {% endif %}
{% endwith %}

<div class="card mt-5">
  <div class="card-body">
    <table class="table table-dark">
      <thead>
        <tr>
          <th class="text-center" scope="col">Email</th>
          <th class="text-center" scope="col">Phishing Emails Detected</th>
          <th class="text-center" scope="col">Last Updated</th>
          <th class="text-center" scope="col">Active Status</th>
          <th class="text-center" scope="col">Clean Mailbox</th>
          <th class="text-center" scope="col">Change Password</th>
          <th class="text-center" scope="col">Activate</th>
        </tr>
      </thead>
      <tbody>
        {% for email in user_emails %}
        <tr>
          <td class="text-center">{{ email.email_address }}</td>
          <td class="text-center">{{ email.phishing_mail_detected }}</td>
          <td class="text-center">{{ email.last_updated }}</td>
          <td class="text-center"> {{ email.active }}</td>
          <td class="text-center"> <a class="lni lni-brush" id="{{ email.email_id }}" name="{{ email.email_address }}" href="#" onclick="phish({{ email.email_id }});"></td>
          <td class="text-center"> <a class="lni lni-pencil"></a></td>
          <td class="text-center"> <a class="lni lni-power-switch" id="{{ email.email_id }}" name="{{ email.email_address}}" href="#" onclick="activate({{ email.email_id }});"></td>
        </tr>
        {% endfor %}
    </table>
  </div>
</div>

<script>
  function phish(mail_id) {
    var names = document.getElementById(mail_id).name;
    let url = "emails/phish/" + mail_id;
    window.location.href = url;
  }

  function activate(mail_id) {
    window.location.href = "emails/activation/" + mail_id;
  }
</script>

{% endblock %}
